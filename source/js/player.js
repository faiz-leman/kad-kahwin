class MusicPlayer{constructor(){this.TITLE="Bermuara â€“ Mahalini & Rizky Febian",this.musicBtn=document.getElementById("musicBtn"),this.musicVisualizer=document.getElementById("musicVisualizer"),this.audioPlayer=document.getElementById("audio"),this.playing=!1,this.visualizerInterval=null,this.userInteracted=!1,this.init()}init(){this.setupAudioPlayer(),this.musicBtn.addEventListener("click",()=>this.toggle()),this.addInteractionListeners()}setupAudioPlayer(){this.audioPlayer&&(this.audioPlayer.loop=!0,this.audioPlayer.preload="auto",this.audioPlayer.addEventListener("play",()=>this.setPlaying(!0)),this.audioPlayer.addEventListener("pause",()=>this.setPlaying(!1)),this.audioPlayer.addEventListener("ended",()=>this.setPlaying(!1)),this.audioPlayer.addEventListener("canplaythrough",()=>{this.userInteracted&&this.tryAutoplay()}),this.tryAutoplay())}addInteractionListeners(){["click","touchstart","keydown","scroll"].forEach(t=>{document.addEventListener(t,()=>{this.userInteracted||(this.userInteracted=!0,this.tryAutoplay())},{once:!0,passive:!0})})}async tryAutoplay(){if(this.audioPlayer&&!this.playing)try{await new Promise(t=>setTimeout(t,500)),this.audioPlayer.readyState>=3?await this.audioPlayer.play():this.audioPlayer.addEventListener("canplaythrough",async()=>{try{await this.audioPlayer.play()}catch(t){}},{once:!0})}catch(t){}}toggle(){this.audioPlayer&&(this.userInteracted=!0,this.playing?this.audioPlayer.pause():this.audioPlayer.play().catch(t=>{}))}setPlaying(t){this.playing=t,t?(this.musicVisualizer&&(this.musicVisualizer.classList.add("playing"),this.startDynamicVisualizer()),this.musicBtn.setAttribute("aria-label","Pause"),this.musicBtn.classList.add("playing")):(this.musicVisualizer&&(this.musicVisualizer.classList.remove("playing"),this.stopDynamicVisualizer()),this.musicBtn.setAttribute("aria-label","Play"),this.musicBtn.classList.remove("playing"))}startDynamicVisualizer(){const t=this.musicVisualizer.querySelectorAll(".visualizer-bar");this.visualizerInterval=setInterval(()=>{t.forEach((t,i)=>{let a,e,s;switch(i){case 0:a=4,e=18,s=Math.random()>.7?.8:.3;break;case 1:a=6,e=16,s=Math.random()>.6?.7:.4;break;case 2:a=5,e=17,s=Math.random()>.5?.9:.5;break;case 3:a=4,e=15,s=Math.random()>.4?.8:.3;break;case 4:a=3,e=14,s=Math.random()>.3?.9:.2}const r=a+(e-a)*s;t.style.height=`${r}px`})},100)}stopDynamicVisualizer(){this.visualizerInterval&&(clearInterval(this.visualizerInterval),this.visualizerInterval=null);this.musicVisualizer.querySelectorAll(".visualizer-bar").forEach((t,i)=>{t.style.height=`${[8,12,6,14,10][i]}px`})}}document.addEventListener("DOMContentLoaded",()=>{new MusicPlayer});